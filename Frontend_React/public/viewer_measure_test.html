<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Viewer measure test (mock UE)</title>
  <style>
    body { margin: 0; font-family: sans-serif; background: #1a1a1a; color: #ccc; }
    #view { width: 100vw; height: 80vh; cursor: crosshair; }
    .bar { padding: 8px; background: #333; }
    button { margin-right: 8px; padding: 6px 12px; cursor: pointer; }
    .point { margin: 4px 0; font-size: 12px; }
  </style>
</head>
<body>
  <div class="bar">
    <button id="start">Start measure</button>
    <button id="stop">Stop measure</button>
    <span id="status">Measure mode: off</span>
  </div>
  <div id="view">Click here to simulate 3D clicks (sends viewerClick to parent).</div>
  <div class="bar">
    <strong>Last points sent:</strong>
    <div id="points"></div>
  </div>
  <script>
    let measureMode = false;
    const points = [];
    const view = document.getElementById('view');
    const status = document.getElementById('status');
    const pointsEl = document.getElementById('points');

    window.addEventListener('message', function (e) {
      if (e.data?.type === 'startMeasure') { measureMode = true; status.textContent = 'Measure mode: on'; }
      if (e.data?.type === 'stopMeasure') { measureMode = false; status.textContent = 'Measure mode: off'; }
    });

    view.addEventListener('click', function (ev) {
      if (!measureMode) return;
      const x = (ev.clientX / window.innerWidth - 0.5) * 100;
      const y = -(ev.clientY / window.innerHeight - 0.5) * 100;
      const z = 0;
      const position = { x, y, z };
      window.parent.postMessage({ type: 'viewerClick', position }, '*');
      points.push(position);
      pointsEl.innerHTML = points.slice(-5).map(function (p, i) {
        return '<div class="point">' + (points.length - 5 + i + 1) + ': (' + p.x.toFixed(2) + ', ' + p.y.toFixed(2) + ', ' + p.z.toFixed(2) + ')</div>';
      }).join('');
    });

    document.getElementById('start').onclick = function () {
      measureMode = true;
      status.textContent = 'Measure mode: on';
      window.parent.postMessage({ type: 'startMeasure' }, '*');
    };
    document.getElementById('stop').onclick = function () {
      measureMode = false;
      status.textContent = 'Measure mode: off';
      window.parent.postMessage({ type: 'stopMeasure' }, '*');
    };
  </script>
</body>
</html>
